<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ä—à–∞ –ª—ñ–≥–∞ | –õ–∞–∑–µ—Ä—Ç–∞–≥</title>
    <!-- Papa Parse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
        /* Base & Layout */
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif;
               background: url('assets/backgr.jpg') center/cover no-repeat;
               color: #fff; }
        nav { background: rgba(0,0,0,0.7); display: flex; justify-content: center; gap: 1rem;
              padding: 1rem; }
        nav a { color: #f39c12; text-decoration: none; font-weight: bold;
                transition: color 0.3s; }
        nav a:hover { color: #ffd700; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 1rem;
                     background: rgba(0,0,0,0.6); border-radius: 12px;
                     box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        h1 { text-align: center; color: #f39c12; text-shadow: 2px 2px 8px #000;
             margin-bottom: 0.5rem; }
        .test-season { text-align: center; color: #e74c3c; margin-bottom: 1rem; }
        .search-box { text-align: center; margin-bottom: 1rem; }
        .search-box input { padding: 0.5rem; border-radius: 6px; border: none;
                            width: 80%; max-width: 300px; }
        /* Top MVP */
        .top-mvp { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;
                   flex-wrap: wrap; }
        .mvp-card { background: rgba(243,156,18,0.1); border: 2px solid #f39c12;
                    border-radius: 10px; padding: 1rem 1.5rem; text-align: center;
                    width: 150px; position: relative; }
        .mvp-card::before { content: 'üèÜ'; position: absolute; top: -10px; right: -10px;
                            font-size: 1.5rem; }
        .mvp-card h3 { margin: 0.5rem 0; color: #f39c12; }
        .mvp-card p { margin: 0; font-size: 1.2rem; }
        /* Table */
        .table-container { overflow-x: auto; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px;
                 background: rgba(26,26,26,0.9); }
        thead th { position: sticky; top: 0; background: #f39c12;
                   color: #000; padding: 0.75rem; }
        th, td { padding: 0.75rem 1rem; text-align: center; border-bottom: 1px solid #444; }
        tbody tr:nth-child(even) { background: rgba(255,255,255,0.05); }
        .rank-S td:nth-child(3) { color: #9b59b6; font-weight: bold; }
        .rank-A td:nth-child(3) { color: #e74c3c; font-weight: bold; }
        .rank-B td:nth-child(3) { color: #f1c40f; font-weight: bold; }
        .rank-C td:nth-child(3) { color: #3498db; font-weight: bold; }
        .rank-D td:nth-child(3) { color: #2ecc71; font-weight: bold; }
        /* Responsive */
        @media (max-width: 768px) {
            .mvp-card { width: 100px; padding: 0.5rem; }
            .table-container { min-width: 600px; }
        }
    </style>
</head>
<body>
<nav>
    <a href="index.html">–ú–æ–ª–æ–¥—à–∞ –õ—ñ–≥–∞</a>
    <a href="sunday.html">–°—Ç–∞—Ä—à–∞ –õ—ñ–≥–∞</a>
    <a href="rules.html">–ü—Ä–∞–≤–∏–ª–∞</a>
    <a href="about.html">–ü—Ä–æ –∫–ª—É–±</a>
</nav>
<div class="container">
    <h1>–°—Ç–∞—Ä—à–∞ –õ—ñ–≥–∞ | –†–µ–π—Ç–∏–Ω–≥ –≥—Ä–∞–≤—Ü—ñ–≤</h1>
    <p class="test-season">‚ö†Ô∏è –¶–µ —Ç–µ—Å—Ç–æ–≤–∏–π —Å–µ–∑–æ–Ω. –î–∞–Ω—ñ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—å.</p>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –Ω—ñ–∫–Ω–µ–π–º—É...">
    </div>
    <!-- Top 3 MVP -->
    <div class="top-mvp" id="topMVP"></div>
    <!-- Ranking Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>–ù—ñ–∫–Ω–µ–π–º</th>
                    <th>–†–∞–Ω–≥</th>
                    <th>–ë–∞–ª–∏</th>
                    <th>–Ü–≥–æ—Ä</th>
                    <th>–ü–µ—Ä–µ–º–æ–≥</th>
                    <th>–ü–æ—Ä–∞–∑–æ–∫</th>
                    <th>WinRate %</th>
                    <th>MVP</th>
                </tr>
            </thead>
            <tbody id="ranking-table"></tbody>
        </table>
    </div>
</div>
<script>
    const rankingURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=1286735969&single=true&output=csv";
    const gamesURL   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=249347260&single=true&output=csv";

    async function loadData() {
        // –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–µ–π—Ç–∏–Ω–≥
        const rankRes = await fetch(rankingURL).then(r => r.text());
        const ranking = Papa.parse(rankRes, {header:true, skipEmptyLines:true}).data;
        // –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–≥—Ä–∏
        const gamesRes = await fetch(gamesURL).then(r => r.text());
        const games = Papa.parse(gamesRes, {header:true, skipEmptyLines:true}).data;
        // —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ Sunday
        const sunday = games.filter(g => g.League === 'sunday');
        // –ø—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ stats
        const stats = {};
        sunday.forEach(g => {
            const t1 = g.Team1.split(',').map(s=>s.trim());
            const t2 = (g.Team2).split(',').map(s=>s.trim());
            const winKey = g.Winner === 'team1' ? t1 : g.Winner === 'team2' ? t2 : [];
            const loseKey = winKey === t1 ? t2 : t1;
            // –±–∞–∑–æ–≤—ñ
            t1.concat(t2).forEach(n=>{
                if(!n) return;
                stats[n] = stats[n]||{games:0,wins:0,losses:0,mvp:0};
                stats[n].games++;
            });
            winKey.forEach(n=>stats[n].wins++);
            loseKey.forEach(n=>stats[n].losses++);
            if(stats[g.MVP]) stats[g.MVP].mvp++;
        });
        // –≥–æ—Ç—É—î–º–æ –º–∞—Å–∏–≤ –≥—Ä–∞–≤—Ü—ñ–≤
        const players = ranking.map((r,i) => {
            const nick = r.Nickname;
            const s = stats[nick]||{games:0,wins:0,losses:0,mvp:0};
            const winRate = s.games>0?((s.wins/s.games)*100).toFixed(2):'0.00';
            const rankClass = (r.Points>=1200?'rank-S':r.Points>=800?'rank-A':r.Points>=500?'rank-B':r.Points>=200?'rank-C':'rank-D');
            return {place: i+1, nickname: nick, points: +r.Points,
                    games: s.games, wins: s.wins, losses: s.losses,
                    winRate, mvp: s.mvp, rankClass};
        });
        renderTopMVP(players);
        renderTable(players);
        document.getElementById('searchInput').addEventListener('input', filterTable);
    }

    function renderTopMVP(players) {
        const top = [...players].sort((a,b)=>b.mvp-a.mvp).slice(0,3);
        const container = document.getElementById('topMVP');
        container.innerHTML = '';
        top.forEach(p=>{
            const div = document.createElement('div');
            div.className = 'mvp-card';
            div.innerHTML = `<h3>${p.nickname}</h3><p>${p.mvp} üèÖ</p>`;
            container.appendChild(div);
        });
    }

    function renderTable(players) {
        const tbody = document.getElementById('ranking-table');
        tbody.innerHTML = '';
        // —Å–æ—Ä—Ç—É—î–º–æ –∑–∞ points
        players.sort((a,b)=>b.points-a.points);
        players.forEach(p=>{
            const tr = document.createElement('tr');
            tr.className = p.rankClass;
            tr.innerHTML = `
                <td>${p.place}</td>
                <td>${p.nickname}</td>
                <td>${p.rankClass.split('-')[1]} —Ä–∞–Ω–≥</td>
                <td>${p.points}</td>
                <td>${p.games}</td>
                <td>${p.wins}</td>
                <td>${p.losses}</td>
                <td>${p.winRate}</td>
                <td>${p.mvp}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function filterTable(e) {
        const q = e.target.value.toLowerCase();
        document.querySelectorAll('#ranking-table tr').forEach(tr => {
            const nick = tr.children[1].textContent.toLowerCase();
            tr.style.display = nick.includes(q)?'' : 'none';
        });
    }

    document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
