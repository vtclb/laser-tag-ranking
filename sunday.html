<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç–∞—Ä—à–∞ –ª—ñ–≥–∞ | –õ–∞–∑–µ—Ä—Ç–∞–≥</title>
  <!-- Papa Parse –¥–ª—è CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    /* –ë–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('assets/backgr.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      background: rgba(0,0,0,0.6);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #f39c12;
      text-shadow: 2px 2px 8px #000;
    }
    /* Top-3 MVP */
    .top-mvp {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .mvp-card {
      background: linear-gradient(135deg, #f39c12, #ffd700);
      color: #000;
      padding: 15px 20px;
      border-radius: 10px;
      width: 150px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
    }
    .mvp-card h2 {
      margin: 0;
      font-size: 1.2rem;
    }
    .mvp-card p {
      margin: 8px 0 0;
      font-size: 2rem;
      font-weight: bold;
    }
    /* –¢–∞–±–ª–∏—Ü—è */
    .table-wrapper {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(26,26,26,0.8);
    }
    th, td {
      padding: 12px 8px;
      border: 1px solid #444;
      text-align: center;
    }
    thead th {
      background: #f39c12;
      color: #000;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody tr:nth-child(odd) {
      background: rgba(255,255,255,0.05);
    }
    .rank-S td:nth-child(3) { color: #9b59b6; }
    .rank-A td:nth-child(3) { color: #e74c3c; }
    .rank-B td:nth-child(3) { color: #f1c40f; }
    .rank-C td:nth-child(3) { color: #3498db; }
    .rank-D td:nth-child(3) { color: #2ecc71; }
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
    @media(max-width: 600px) {
      h1 { font-size: 1.8rem; }
      .mvp-card { width: 100px; padding: 10px; }
      .mvp-card p { font-size: 1.5rem; }
      th, td { padding: 8px 4px; font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–°—Ç–∞—Ä—à–∞ –ª—ñ–≥–∞ | –†–µ–π—Ç–∏–Ω–≥ –≥—Ä–∞–≤—Ü—ñ–≤</h1>
    <!-- –¢–æ–ø-3 MVP -->
    <div class="top-mvp" id="top-mvp">
      <!-- MVP-–∫–∞—Ä—Ç–∫–∏ –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è JS -->
    </div>
    <!-- –¢–∞–±–ª–∏—Ü—è —Ä–µ–π—Ç–∏–Ω–≥—ñ–≤ -->
    <div class="table-wrapper">
      <table id="ranking-table">
        <thead>
          <tr>
            <th>–ú—ñ—Å—Ü–µ</th>
            <th>–ù—ñ–∫–Ω–µ–π–º</th>
            <th>–†–∞–Ω–≥</th>
            <th>–ë–∞–ª–∏</th>
            <th>–Ü–≥–æ—Ä</th>
            <th>–ü–µ—Ä–µ–º–æ–≥</th>
            <th>–ü–æ—Ä–∞–∑–æ–∫</th>
            <th>WinRate %</th>
            <th>MVP</th>
          </tr>
        </thead>
        <tbody>
          <!-- –†—è–¥–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥—É -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const rankingURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=1286735969&single=true&output=csv";
    const gamesURL   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=249347260&single=true&output=csv";
    
    async function loadData() {
      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–µ–π—Ç–∏–Ω–≥
      const rankText = await fetch(rankingURL).then(r => r.text());
      const ranking = Papa.parse(rankText, { header: true, skipEmptyLines: true }).data;
      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–≥—Ä–∏
      const gamesText = await fetch(gamesURL).then(r => r.text());
      const games = Papa.parse(gamesText, { header: true, skipEmptyLines: true }).data;
      // –§—ñ–ª—å—Ç—Ä—É—î–º–æ Sunday
      const sundayGames = games.filter(g => g.League === 'sunday');
      // –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      const stats = {};
      sundayGames.forEach(g => {
        const t1 = g.Team1.split(',').map(s=>s.trim());
        const t2 = g.Team2.split(',').map(s=>s.trim());
        let winTeam = [], loseTeam = [];
        if (g.Winner === 'team1') { winTeam = t1; loseTeam = t2; }
        else if (g.Winner === 'team2') { winTeam = t2; loseTeam = t1; }
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        [...t1, ...t2].forEach(n => {
          if (!n) return;
          stats[n] = stats[n] || { games:0, wins:0, losses:0, mvp:0 };
          stats[n].games++;
        });
        winTeam.forEach(n=> stats[n].wins++);
        loseTeam.forEach(n=> stats[n].losses++);
        if (stats[g.MVP]) stats[g.MVP].mvp++;
      });
      // –û–±'—î–¥–Ω–∞–Ω–Ω—è –Ω—ñ–∫–Ω–µ–π–º—ñ–≤
      const alias = { 'Zavodchanyn':'Romario', 'Mariko':'Gidora' };
      Object.keys(alias).forEach(a=>{
        if (stats[a]) {
          const tgt = alias[a];
          stats[tgt] = stats[tgt] || { games:0, wins:0, losses:0, mvp:0 };
          ['games','wins','losses','mvp'].forEach(k=> stats[tgt][k] += stats[a][k]);
          delete stats[a];
        }
      });
      // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±'—î–∫—Ç—É –≥—Ä–∞–≤—Ü—ñ–≤
      const players = ranking
        .filter(r=>!alias[r.Nickname])
        .map((r,i)=>{
          const nick = r.Nickname;
          const s = stats[nick] || { games:0, wins:0, losses:0, mvp:0 };
          const winRate = s.games ? ((s.wins/s.games)*100).toFixed(2) : '0.00';
          return {
            place: i+1, nickname: nick, points: +r.Points,
            games: s.games, wins: s.wins, losses: s.losses,
            winRate, mvp: s.mvp,
            rankClass: getRankClass(+r.Points)
          };
        });
      renderTopMVP(players);
      renderRanking(players);
    }

    function getRankClass(points) {
      if (points>=1200) return 'rank-S';
      if (points>=800)  return 'rank-A';
      if (points>=500)  return 'rank-B';
      if (points>=200)  return 'rank-C';
      return 'rank-D';
    }

    function renderTopMVP(pl) {
      const top = [...pl].sort((a,b)=>b.mvp-a.mvp).slice(0,3);
      const container = document.getElementById('top-mvp');
      container.innerHTML = '';
      top.forEach(p=>{
        const div = document.createElement('div'); div.className='mvp-card';
        div.innerHTML = `<h2>${p.nickname}</h2><p>üèÜ ${p.mvp}</p><small>MVP</small>`;
        container.appendChild(div);
      });
    }

    function renderRanking(pl) {
      const tbody = document.querySelector('#ranking-table tbody');
      tbody.innerHTML = '';
      pl.sort((a,b)=>b.points-a.points).forEach(p=>{
        const tr = document.createElement('tr'); tr.className=p.rankClass;
        tr.innerHTML = `
          <td>${p.place}</td>
          <td>${p.nickname}</td>
          <td>${p.rankClass.replace('rank-','')}</td>
          <td>${p.points}</td>
          <td>${p.games}</td>
          <td>${p.wins}</td>
          <td>${p.losses}</td>
          <td>${p.winRate}</td>
          <td>${p.mvp}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
