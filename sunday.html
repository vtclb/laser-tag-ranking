<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°—Ç–∞—Ä—à–∞ –ª—ñ–≥–∞ | –õ–∞–∑–µ—Ä—Ç–∞–≥</title>
  <!-- Papa Parse –¥–ª—è CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    /* Reset */
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family:'Segoe UI',sans-serif; background:#111; color:#fff; }
    nav { background:rgba(0,0,0,0.8); padding:10px; display:flex; justify-content:center; gap:20px; }
    nav a { color:#f39c12; text-decoration:none; font-weight:600; transition:color .3s; }
    nav a:hover, nav a.active { color:#ffd700; }
    .container { max-width:1200px; margin:20px auto; padding:0 10px; }
    .test-season { text-align:center; margin:10px 0; color:#e74c3c; }
    .search-box { text-align:center; margin:10px 0; }
    .search-box input { padding:8px; width:100%; max-width:300px; border-radius:5px; border:none; }
    .top-mvp { display:flex; justify-content:center; gap:20px; margin:20px 0; flex-wrap:wrap; }
    .mvp-card { background:rgba(243,156,18,0.2); border:1px solid #f39c12; border-radius:10px; padding:15px; width:150px; text-align:center; }
    .mvp-card h3 { margin:10px 0; font-size:1.2em; }
    .table-wrapper { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; margin-bottom:20px; }
    th, td { padding:10px; text-align:center; }
    thead th { background:#f39c12; color:#000; position:sticky; top:0; z-index:1; }
    tbody tr:nth-child(odd) { background:rgba(255,255,255,0.05); }
    tbody tr:hover { background:rgba(243,156,18,0.2); }
    @media(max-width:600px) {
      .mvp-card { width:100px; padding:10px; }
      th, td { padding:6px; font-size:0.9em; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">–ú–æ–ª–æ–¥—à–∞ –ª—ñ–≥–∞</a>
    <a href="sunday.html" class="active">–°—Ç–∞—Ä—à–∞ –ª—ñ–≥–∞</a>
    <a href="rules.html">–ü—Ä–∞–≤–∏–ª–∞</a>
    <a href="about.html">–ü—Ä–æ –∫–ª—É–±</a>
  </nav>
  <div class="container">
    <p class="test-season">‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–∏–π —Å–µ–∑–æ–Ω. –î–∞–Ω—ñ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—å.</p>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –Ω—ñ–∫—É..." oninput="filterTable()" />
    </div>
    <div id="topMVP" class="top-mvp"></div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th><th>–ù—ñ–∫–Ω–µ–π–º</th><th>–†–∞–Ω–≥</th><th>–ë–∞–ª–∏</th>
            <th>–Ü–≥–æ—Ä</th><th>–ü–µ—Ä–µ–º–æ–≥</th><th>–ü–æ—Ä–∞–∑–æ–∫</th><th>WinRate %</th><th>MVP</th>
          </tr>
        </thead>
        <tbody id="rankingTable"></tbody>
      </table>
    </div>
  </div>
  <script>
    const rankingURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=1286735969&single=true&output=csv';
    const gamesURL   = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSzum1H-NSUejvB_XMMWaTs04SPz7SQGpKkyFwz4NQjsN8hz2jAFAhl-jtRdYVAXgr36sN4RSoQSpEN/pub?gid=249347260&single=true&output=csv';

    async function loadData() {
      // –ü–∞—Ä—Å —Ä–µ–π—Ç–∏–Ω–≥
      const rText = await fetch(rankingURL).then(r=>r.text());
      const ranking = Papa.parse(rText,{header:true,skipEmptyLines:true}).data
        .filter(r=>r.Nickname);
      // –ü–∞—Ä—Å —ñ–≥–æ—Ä
      const gText = await fetch(gamesURL).then(r=>r.text());
      const games = Papa.parse(gText,{header:true,skipEmptyLines:true}).data
        .filter(g=>g.League==='sunday');
      // –ó–ª–∏—Ç—Ç—è –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤
      const aliasMap = {'Mariko':'Gidora','Zavodchanyn':'Romario','Timabuilding':'–ë–æ–π–±—É–¥'};
      // –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—Ç–∞—Ç
      const stats = {};
      games.forEach(g=>{
        let t1=g.Team1.split(',').map(s=>s.trim()),t2=g.Team2.split(',').map(s=>s.trim());
        // –≤–∏–∑–Ω–∞—á–∞—î–º–æ –≤–∏–≥—Ä–∞—à–Ω—É –∫–æ–º–∞–Ω–¥—É
        const winKey =(g.Winner==='team1'?t1:(g.Winner==='team2'?t2:[]));
        const loseKey = winKey===t1?t2:t1;
        t1.concat(t2).forEach(nick=>{
          if(!nick) return;
          const n=aliasMap[nick]||nick;
          if(!stats[n]) stats[n]={games:0,wins:0};
          stats[n].games++;
        });
        winKey.map(n=>aliasMap[n]||n).forEach(n=>stats[n].wins++);
      });
      // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—É –≥—Ä–∞–≤—Ü—ñ–≤
      const players = ranking.map((r,i)=>{
        let nick=r.Nickname;
        nick=aliasMap[nick]||nick;
        const pts=+r.Points;
        const gameCount = stats[nick]?.games||0;
        const winCount = stats[nick]?.wins||0;
        const lossCount=gameCount-winCount;
        const winRate = gameCount?((winCount/gameCount*100).toFixed(2)):'-';
        const mvpCount = stats[nick]?.mvp||0;
        return {nick,pts,gameCount,winCount,lossCount,winRate,mvpCount};
      });
      // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –±–∞–ª–∞–º–∏
      players.sort((a,b)=>b.pts-a.pts);
      renderRanking(players);
      renderTopMVP(players);
    }
    function renderTopMVP(players){
      const top=players.sort((a,b)=>b.mvpCount-a.mvpCount).slice(0,3);
      const container=document.getElementById('topMVP');container.innerHTML='';
      top.forEach(p=>{
        const div=document.createElement('div');div.className='mvp-card';
        div.innerHTML=`<div>üèÜ</div><h3>${p.nick}</h3><div>${p.mvpCount} MVP</div>`;
        container.appendChild(div);
      });
    }
    function renderRanking(players){
      const tbody=document.getElementById('rankingTable');tbody.innerHTML='';
      players.forEach((p,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td>
          <td>${p.nick}</td>
          <td>${p.pts}</td>
          <td>${p.gameCount||'-'}</td>
          <td>${p.winCount||'-'}</td>
          <td>${p.lossCount||'-'}</td>
          <td>${p.winRate}</td>
          <td>${p.mvpCount||'-'}</td>`;
        tbody.appendChild(tr);
      });
    }
    function filterTable(){
      const q=document.getElementById('searchInput').value.toLowerCase();
      document.querySelectorAll('#rankingTable tr').forEach(tr=>{
        tr.style.display=tr.cells[1].textContent.toLowerCase().includes(q)?'':'none';
      });
    }
    document.addEventListener('DOMContentLoaded',loadData);
  </script>
</body>
</html>
