<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç–∞—Ä—à–∞ –õ—ñ–≥–∞ | –õ–∞–∑–µ—Ä—Ç–∞–≥</title>
  <!-- Papa Parse –¥–ª—è CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    /* Reset */
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family:'Segoe UI',sans-serif; background:#1a1a1a; color:#fff; }
    nav { background:rgba(0,0,0,0.8); padding:10px; display:flex; justify-content:center; gap:20px; position:sticky; top:0; z-index:100; }
    nav a { color:#f39c12; text-decoration:none; font-weight:600; }
    nav a.active, nav a:hover { color:#ffd700; border-bottom:2px solid #ffd700; }
    .container { max-width:1200px; margin:20px auto; padding:0 10px; }
    .test-season { text-align:center; margin:10px 0; color:#e74c3c; }
    .search-box { text-align:center; margin:15px 0; }
    .search-box input { width:100%; max-width:300px; padding:8px; border-radius:4px; border:none; }
    .top3 { display:flex; justify-content:center; gap:20px; margin:20px 0; flex-wrap:wrap; }
    .mvp-card { background:rgba(243,156,18,0.2); padding:15px; border-radius:8px; width:200px; text-align:center; }
    .mvp-card h3 { margin:10px 0 5px; font-size:1.2rem; }
    .mvp-card .count { font-size:2rem; color:#f1c40f; }
    .table-container { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; margin-bottom:20px; }
    th, td { padding:10px; border:1px solid #333; text-align:center; }
    thead { background:#f39c12; color:#000; position:sticky; top:0; z-index:50; }
    tbody tr:nth-child(even) { background:rgba(255,255,255,0.05); }
    tbody tr:hover { background:rgba(243,156,18,0.2); }
    .hidden { display:none; }
  </style>
</head>
<body>
<nav>
  <a href="index.html">–ú–æ–ª–æ–¥—à–∞ –õ—ñ–≥–∞</a>
  <a href="sunday.html" class="active">–°—Ç–∞—Ä—à–∞ –õ—ñ–≥–∞</a>
  <a href="rules.html">–ü—Ä–∞–≤–∏–ª–∞</a>
  <a href="about.html">–ü—Ä–æ –∫–ª—É–±</a>
</nav>
<div class="container">
  <p class="test-season">‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–∏–π —Å–µ–∑–æ–Ω. –î–∞–Ω—ñ –º–æ–∂—É—Ç—å –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—è.</p>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –Ω—ñ–∫–Ω–µ–π–º—É..." />
  </div>
  <div id="top3" class="top3"></div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>–ú—ñ—Å—Ü–µ</th>
          <th>–ù—ñ–∫–Ω–µ–π–º</th>
          <th>–†–∞–Ω–≥</th>
          <th>–ë–∞–ª–∏</th>
          <th>–Ü–≥–æ—Ä</th>
          <th>–ü–µ—Ä–µ–º–æ–≥</th>
          <th>–ü–æ—Ä–∞–∑–æ–∫</th>
          <th>WinRate (%)</th>
          <th>MVP</th>
        </tr>
      </thead>
      <tbody id="ranking"></tbody>
    </table>
  </div>
</div>
<script>
const rankingURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-.../pub?gid=1286735969&single=true&output=csv';
const gamesURL   = 'https://docs.google.com/spreadsheets/d/e/2PACX-.../pub?gid=249347260&single=true&output=csv';

// –ê–ª–∏–∞—Å–∏ –Ω—ñ–∫–Ω–µ–π–º—ñ–≤
const aliases = { 'Zavodchanyn':'Romario', 'Mariko':'Gidora', 'Timabuilding':'–ë–æ–π–±—É–¥' };

async function loadData() {
  const [rankTxt, gamesTxt] = await Promise.all([
    fetch(rankingURL).then(r=>r.text()),
    fetch(gamesURL).then(r=>r.text())
  ]);
  const ranking = Papa.parse(rankTxt, {header:true, skipEmptyLines:true}).data
    .map(r=>({ Nickname:r.Nickname, Points:+r.Points }));
  const games = Papa.parse(gamesTxt, {header:true, skipEmptyLines:true}).data;

  // –ó–ª–∏—Ç—Ç—è aliases
  ranking.forEach(p=>{ if(aliases[p.Nickname]) p.Nickname=aliases[p.Nickname]; });

  // –Ü–≥—Ä–∏ —Ç—ñ–ª—å–∫–∏ Sunday
  const sunday = games.filter(g=>g.League==='sunday');
  const stats = {};
  sunday.forEach(g=>{
    let t1=g.Team1.split(',').map(s=>s.trim()),
        t2=g.Team2.split(',').map(s=>s.trim());
    // –ü–µ—Ä–µ–º–æ–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
    const winT = (g.Winner==='team1'?t1:g.Winner==='team2'?t2:[]);
    const loseT= winT===t1?t2:t1;
    // –†–∞—Ö—É—î–º–æ
    [...t1,...t2].forEach(n=>{ n=aliases[n]||n; stats[n]=stats[n]||{games:0,wins:0,losses:0,mvp:0}; stats[n].games++; });
    winT.forEach(n=>{n=aliases[n]||n; stats[n].wins++;});
    loseT.forEach(n=>{n=aliases[n]||n; stats[n].losses++;});
    const m=g.MVP; if(m){ const n=aliases[m]||m; stats[n].mvp=(stats[n].mvp||0)+1; }
  });

  // –ó–ª–∏–≤–∞—î–º–æ –∑ —Ä–µ–π—Ç–∏–Ω–≥–æ–º
  const players = ranking.map((p,i)=>{
    const s = stats[p.Nickname]||{games:0,wins:0,losses:0,mvp:0};
    const losses = s.losses || (s.games - s.wins);
    return { ...p, games:s.games, wins:s.wins, losses, winRate:s.games?((s.wins/s.games*100).toFixed(2)): '0.00', mvp:s.mvp };
  });
  renderTop3(players);
  renderRanking(players);
  document.getElementById('searchInput').addEventListener('input',()=>filterData(players));
}

function renderTop3(arr) {
  const top = [...arr].sort((a,b)=>b.mvp-a.mvp).slice(0,3);
  const el = document.getElementById('top3'); el.innerHTML='';
  top.forEach(p=>{
    const div=document.createElement('div'); div.className='mvp-card';
    div.innerHTML=`<h3>${p.Nickname}</h3><div class='count'>üèÜ ${p.mvp}</div><div>MVP</div>`;
    el.appendChild(div);
  });
}

function renderRanking(arr) {
  const sorted = [...arr].sort((a,b)=>b.Points-a.Points);
  const tbody = document.getElementById('ranking'); tbody.innerHTML='';
  sorted.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${p.Nickname}</td>
      <td>${p.Points}</td>
      <td>${p.games||'-'}</td>
      <td>${p.wins||'-'}</td>
      <td>${p.losses||'-'}</td>
      <td>${p.winRate||'-'}</td>
      <td>${p.mvp||'-'}</td>
    `;
    tbody.appendChild(tr);
  });
}

function filterData(arr) {
  const q=document.getElementById('searchInput').value.toLowerCase();
  const rows=document.querySelectorAll('#ranking tr');
  rows.forEach((r,i)=>{
    const name=r.cells[1].textContent.toLowerCase();
    r.style.display = name.includes(q)?'':'none';
  });
}

document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
