<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile | v2</title>
  <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">Player Profile</div>
    <a class="nav-link" href="./league.html">League</a>
  </header>
  <main id="content"></main>

  <script type="module">
    import { getPlayerProfile } from '../core/dataHub.js';
    import { getQueryParams } from '../core/utils.js';

    const { nick = '' } = getQueryParams();
    const content = document.getElementById('content');

    function renderList(items, metric) {
      if (!items?.length) return '<li>—</li>';
      return items.map((item) => `<li>${item.nick} (${item[metric]})</li>`).join('');
    }

    async function init() {
      if (!nick) {
        content.innerHTML = '<section class="card"><h1>Player not found</h1></section>';
        return;
      }

      try {
        const profile = await getPlayerProfile({ nick });
        if (!profile) {
          content.innerHTML = '<section class="card"><h1>Player not found</h1></section>';
          return;
        }

        content.innerHTML = `
          <section class="card">
            <h1 class="section-title">${profile.nick}</h1>
            <p class="tag">All-time</p>
            <div class="kpi" style="margin-top:.8rem;">
              <article class="card"><p class="tag">Games</p><h3>${profile.allTime.games}</h3></article>
              <article class="card"><p class="tag">Points</p><h3>${profile.allTime.points}</h3></article>
              <article class="card"><p class="tag">MVP</p><h3>${profile.allTime.mvp}</h3></article>
            </div>
          </section>
          <section class="card">
            <h2>Stats by season</h2>
            <ul class="list-clean">
              ${profile.seasons.map((item) => `<li>${item.seasonTitle}: ${item.points} pts / ${item.games} games / leagues: ${item.leagues.join(', ')}</li>`).join('')}
            </ul>
          </section>
          <section class="profile-grid">
            <article class="card"><h3>Top teammates</h3><ul class="list-clean">${renderList(profile.insights.topTeammates, 'gamesTogether')}</ul></article>
            <article class="card"><h3>Top opponents</h3><ul class="list-clean">${renderList(profile.insights.topOpponents, 'gamesAgainst')}</ul></article>
          </section>
        `;
      } catch (error) {
        content.innerHTML = '<section class="card"><h1>Не вдалося завантажити дані</h1><p>Спробуйте оновити сторінку пізніше.</p></section>';
      }
    }

    init();
  </script>
</body>
</html>
